{{- if not (eq .workdotfilesrepo "") -}}
#!/bin/bash

set -euo pipefail

WORK_DOTFILES_DEST="${HOME}/dotfiles"

if [[ ! -d $WORK_DOTFILES_DEST ]]; then
  git clone {{ .workdotfilesrepo }} $WORK_DOTFILES_DEST
fi

cat $WORK_DOTFILES_DEST/.zshrc >> ~/.zshrc
cat $WORK_DOTFILES_DEST/.gitconfig >> ~/.gitconfig

{{- if (hasKey .chezmoi.osRelease "name") }}
{{- if (eq .chezmoi.osRelease.name "Ubuntu") }}
    sudo apt update
{{- end }}
{{- end }}

# Ensure kubectl and kubectx.
if ! command -v kubectl >/dev/null; then
{{- if eq .chezmoi.os "darwin" }}
    brew install kubectl
    brew install kubectx
{{- else if (hasKey .chezmoi.osRelease "name") }}
{{- if (eq .chezmoi.osRelease.name "Ubuntu") }}
    sudo apt install -y kubectl
	sudo apt install -y kubectx
{{- end }}
{{- end }}
fi

# Ensure pyenv.
if ! command -v pyenv >/dev/null; then
{{- if eq .chezmoi.os "darwin" }}
    brew install pyenv
    brew install pyenv-virtualenv
{{- else if (hasKey .chezmoi.osRelease "name") }}
{{- if (eq .chezmoi.osRelease.name "Ubuntu") }}
    git clone https://github.com/pyenv/pyenv.git ~/.pyenv 
	git clone https://github.com/pyenv/pyenv-virtualenv.git $(pyenv root)/plugins/pyenv-virtualenv
{{- end }}
{{- end }}
fi

# Ensure plantuml.
if ! command -v plantuml >/dev/null; then
{{- if eq .chezmoi.os "darwin" }}
    brew install graphviz
    brew install plantuml
{{- else if (hasKey .chezmoi.osRelease "name") }}
{{- if (eq .chezmoi.osRelease.name "Ubuntu") }}
    sudo apt install plantuml -y
{{- end }}
{{- end }}
fi

# Ensure jfrog.
if ! command -v jfrog >/dev/null; then
{{- if eq .chezmoi.os "darwin" }}
    brew install jfrog-cli
{{- else if (hasKey .chezmoi.osRelease "name") }}
{{- if (eq .chezmoi.osRelease.name "Ubuntu") }}
    sudo apt install jfrog-cli -y
{{- end }}
{{- end }}
fi

{{- end }}
